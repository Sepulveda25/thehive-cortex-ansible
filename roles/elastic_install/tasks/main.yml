---

- name: Instala la clave de Elastic
  become: yes
  become_user: root
  apt-key: keyserver=keyserver.ubuntu.com id=D88E42B4

- name: Configuracion del repositorio de Elastic
  become: yes
  become_user: root
  command: echo "deb https://artifacts.elastic.co/packages/5.x/apt stable main" | sudo tee -a /etc/apt/sources.list.d/elastic-5.x.list

- name: Instalar soporte para apt con https
  become: yes
  become_user: root
  apt:
   name: apt-transport-https
   update_cache: yes

- name: Instalaci√≥n de Elasticsearch
  become: yes
  become_user: root
  apt:
   name: elasticsearch

- name: Moverse a la carpeta /etc/elasticsearch para editar el archivo elasticsearch.yml
  become: yes
  become_user: root
  command: chdir=/etc/elasticsearch

- name: Moverse a la carpeta /etc/elasticsearch para editar el archivo elasticsearch.yml
  become: yes
  become_user: root
  blockinfile:- name: Insert multiple lines and Backup
  blockinfile:
    path: /etc/ssh/sshd_config
    backup: yes
    block: |
      network.host: 127.0.0.1
      script.inline: true
      cluster.name: hive
      thread_pool.index.queue_size: 100000
      thread_pool.search.queue_size: 100000
      thread_pool.bulk.queue_size: 100000

- name: Reinicia los daemon para ejecutar el servicio de elasticsearch
  become: true
  systemd:
   state: restarted
   daemon_reload: yes

- name: Habilita e inicia el servicio de elasticsearch
  become: true
  systemd:
    name: elasticsearch
    enable: yes
    state: start


